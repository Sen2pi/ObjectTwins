<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Diagrama de Componentes — ObjectTwins</title>
  <style>
    body { font-family: Segoe UI, Roboto, Arial, sans-serif; margin: 0; padding: 0; }
    header { padding: 12px 16px; background: #0b5cff; color: #fff; }
    main { padding: 16px; }
    #diagram { width: 100%; border: 0; }
    pre { background: #f5f7fb; padding: 12px; overflow: auto; }
  </style>
</head>
<body>
  <header>Diagrama de Componentes — ObjectTwins Activity Provider</header>
  <main>
    <img id="diagram" src="" alt="Diagrama de Componentes ObjectTwins" style="width:100%; height:auto; border:0" referrerpolicy="no-referrer" loading="eager">
    <div id="fallback" style="margin-top:12px"></div>
    <h2>Código PlantUML</h2>
    <pre id="puml" style="white-space: pre-wrap">@startuml
skinparam componentStyle uml2
skinparam defaultTextAlignment center
skinparam shadowing false
skinparam nodesep 35
skinparam ranksep 70
skinparam linetype ortho
left to right direction
scale 1448x1024

title ObjectTwins Activity Provider — Diagrama de Componentes

component "Inven!RA" as InvenRA #FFD54F {
  interface IAutenticaçãoInvenRA
}
component "«subsystem» ObjectTwins" as ObjectTwinsSystem {
  port PortoInvenRA
}

component "«subsystem» Camada de Apresentação" as SubApresentacao #E8F1FF {
  component "«component» Visualizador3D" as Visualizador3D #90CAF9 {
    port PortoUI
    note right of PortoUI : Interação e renderização UI
    interface IVisualização
    note right of IVisualização : Interface de visualização 3D
  }
}

component "«subsystem» Camada de Gestão" as SubGestao #E8F5E9 {
  component "«component» GestorSessão" as GestorSessao #A5D6A7 {
    port PortoSessao
    note right of PortoSessao : Gestão de sessão
    interface IControleSessão
    note right of IControleSessão : Controlo de sessão
    interface IGestãoUtilizador
    note right of IGestãoUtilizador : Gestão de utilizador
    interface IDadosSessão
    note right of IDadosSessão : Dados da sessão
  }
  component "«component» GestorAnalytics" as GestorAnalytics #A5D6A7 {
    port PortoAnalytics
    note right of PortoAnalytics : Ponto de analítica
    interface IMétricasQuantitativas
    note right of IMétricasQuantitativas : Métricas quantitativas
    interface IRelatóriosQualitativos
    note right of IRelatóriosQualitativos : Relatórios qualitativos
    interface IDadosAnalíticos
    note right of IDadosAnalíticos : Dados analíticos
  }
}

component "«subsystem» Camada de Criação e Configuração" as SubCriacao #FFF3E0 {
  component "«component» CriadorObjetos" as CriadorObjetos #FFCC80 {
    port PortoCriacao
    note right of PortoCriacao : Criação e configuração
    interface ICriaçãoObjetos
    note right of ICriaçãoObjetos : Criação de objetos
    interface IModelagem3D
    note right of IModelagem3D : Modelagem 3D
    interface IDadosObjetos
    note right of IDadosObjetos : Dados de objetos
    interface IPropriedadesObjetos
    note right of IPropriedadesObjetos : Propriedades dos objetos
  }
  component "«component» GestorMateriais" as GestorMateriais #FFCC80 {
    port PortoMateriais
    note right of PortoMateriais : Gestão de materiais
    interface IBaseDadosMateriais
    note right of IBaseDadosMateriais : Base de dados de materiais
    interface IPropriedadesFísicas
    note right of IPropriedadesFísicas : Propriedades físicas
    interface IDadosMateriais
    note right of IDadosMateriais : Dados de materiais
    interface IPropriedadesMateriais
    note right of IPropriedadesMateriais : Propriedades de materiais
  }
}

component "«subsystem» Camada de Simulação e Análise" como SubSimulacao #F3E5F5 {
  component "«component» MotorSimulação" as MotorSimulacao #CE93D8 {
    port PortoSimulacao
    note right of PortoSimulacao : Execução da simulação
    interface ISimulaçãoFísica
    note right of ISimulaçãoFísica : Simulação física
    interface IConfiguraçãoAmbiente
    note right of IConfiguraçãoAmbiente : Configuração de ambiente
    interface IDadosSimulação
    note right of IDadosSimulação : Dados da simulação
    interface IResultadosSimulação
    note right of IResultadosSimulação : Resultados da simulação
    interface IEstadoSimulação
    note right of IEstadoSimulação : Estado da simulação
  }
  component "«component» Detetor Colisões" as DetetorColisoes #CE93D8 {
    port PortoColisoes
    note right of PortoColisoes : Deteção de colisões
    interface IDeteçãoColisões
    note right of IDeteçãoColisões : Deteção de colisões
    interface ICálculoDanos
    note right of ICálculoDanos : Cálculo de danos
    interface IDadosColisões
    note right of IDadosColisões : Dados de colisões
  }
  component "«component» AnalisadorResultados" as AnalisadorResultados #CE93D8 {
    port PortoAnalise
    note right of PortoAnalise : Análise de resultados
    interface IAnáliseDesempenho
    note right of IAnáliseDesempenho : Análise de desempenho
    interface IEstatísticas
    note right of IEstatísticas : Estatísticas
    interface IResultadosAnálise
    note right of IResultadosAnálise : Resultados de análise
  }
}

component "«subsystem» Camada de Exportação" as SubExportacao #E0F2F1 {
  component "«component» ExportadorDados" as ExportadorDados #80CBC4 {
    port PortoExportacao
    note right of PortoExportacao : Exportação de dados
    interface IExportaçãoCSV
    note right of IExportaçãoCSV : Exportação em CSV
    interface IExportaçãoJSON
    note right of IExportaçãoJSON : Exportação em JSON
    interface IDadosExportação
    note right of IDadosExportação : Dados de exportação
  }
}

PortoInvenRA --> PortoSessao : [delegate] IConfiguraçãoAtividade
GestorAnalytics -left- IDadosAnalíticos
PortoAnalytics --> PortoInvenRA : [delegate] IDadosAnalíticos
InvenRA --> PortoInvenRA : IConfiguraçãoAtividade

Visualizador3D -left-0 IVisualização
InvenRA -left-0 IAutenticaçãoInvenRA
Visualizador3D ..> IDadosSimulação
Visualizador3D ..> IModelagem3D

GestorSessao -left-0 IControleSessão
GestorSessao -left-0 IGestãoUtilizador
GestorSessao -left-0 IDadosSessão
GestorSessao ..> IAutenticaçãoInvenRA

GestorAnalytics -left-0 IMétricasQuantitativas
GestorAnalytics -left-0 IRelatóriosQualitativos
GestorAnalytics -left-0 IDadosAnalíticos
GestorAnalytics ..> IDadosSessão
GestorAnalytics ..> IDadosSimulação

CriadorObjetos -left-0 ICriaçãoObjetos
CriadorObjetos -left-0 IModelagem3D
CriadorObjetos -left-0 IDadosObjetos
CriadorObjetos -left-0 IPropriedadesObjetos
CriadorObjetos ..> IDadosMateriais
CriadorObjetos ..> IPropriedadesMateriais

GestorMateriais -left-0 IBaseDadosMateriais
GestorMateriais -left-0 IPropriedadesFísicas
GestorMateriais -left-0 IDadosMateriais
GestorMateriais -left-0 IPropriedadesMateriais

MotorSimulacao -left-0 ISimulaçãoFísica
MotorSimulacao -left-0 IConfiguraçãoAmbiente
MotorSimulacao -left-0 IDadosSimulação
MotorSimulacao -left-0 IResultadosSimulação
MotorSimulacao -left-0 IEstadoSimulação
MotorSimulacao ..> IDadosObjetos
MotorSimulacao ..> IPropriedadesMateriais

DetetorColisoes -left-0 IDeteçãoColisões
DetetorColisoes -left-0 ICálculoDanos
DetetorColisoes ..> IEstadoSimulação
DetetorColisoes ..> IPropriedadesObjetos

AnalisadorResultados -left-0 IAnáliseDesempenho
AnalisadorResultados -left-0 IEstatísticas
AnalisadorResultados -left-0 IResultadosAnálise
AnalisadorResultados ..> IDadosColisões
AnalisadorResultados ..> IResultadosSimulação

ExportadorDados -left-0 IExportaçãoCSV
ExportadorDados -left-0 IExportaçãoJSON
ExportadorDados ..> IResultadosAnálise

CriadorObjetos ..> GestorMateriais : IDadosMateriais
MotorSimulacao ..> CriadorObjetos : IDadosObjetos
MotorSimulacao ..> GestorMateriais : IPropriedadesMateriais
DetetorColisoes ..> MotorSimulacao : IEstadoSimulação
DetetorColisoes ..> CriadorObjetos : IPropriedadesObjetos
AnalisadorResultados ..> DetetorColisoes : IDadosColisões
AnalisadorResultados ..> MotorSimulacao : IResultadosSimulação
ExportadorDados ..> AnalisadorResultados : IResultadosAnálise
Visualizador3D ..> MotorSimulacao : IDadosSimulação
Visualizador3D ..> CriadorObjetos : IModelos3D
GestorAnalytics ..> GestorSessao : IDadosSessão
GestorAnalytics ..> MotorSimulacao : IDadosSimulação
GestorAnalytics ..> ExportadorDados : IDadosExportação

PortoSessao --> PortoUI : IControleSessão
PortoSessao --> PortoSimulacao : IControleSessão
PortoSessao --> PortoColisoes : IControleSessão
PortoSessao --> PortoCriacao : IControleSessão
PortoSessao --> PortoMateriais : IControleSessão
PortoSessao --> PortoAnalise : IControleSessão
PortoSessao --> PortoExportacao : IControleSessão
PortoSessao --> PortoAnalytics : IControleSessão

@enduml</pre>
    <h2>Explicação Geral</h2>
    <section>
      <p><strong><a href="wiki.html#sistema">Sistema</a></strong>: «subsystem» ObjectTwins integra-se com Inven!RA via PortoInvenRA, recebendo IConfiguraçãoAtividade e publicando IDadosAnalíticos.</p>
      <p><strong><a href="wiki.html#apresentacao">Apresentação</a></strong>: Visualizador3D fornece IVisualização e requer IDadosSimulação e IModelos3D para renderização 3D.</p>
      <p><strong><a href="wiki.html#gestao">Gestão</a></strong>: GestorSessão fornece IControleSessão e IGestãoUtilizador e requer IAutenticaçãoInvenRA. GestorAnalytics fornece IMétricasQuantitativas e IRelatóriosQualitativos, requer IDadosSessão, IDadosSimulação e IDadosExportação e publica IDadosAnalíticos.</p>
      <p><strong><a href="wiki.html#criacao">Criação e Configuração</a></strong>: CriadorObjetos fornece ICriaçãoObjetos e IModelagem3D e requer IDadosMateriais do GestorMateriais, que fornece IBaseDadosMateriais e IPropriedadesFísicas.</p>
      <p><strong><a href="wiki.html#simulacao">Simulação e Análise</a></strong>: MotorSimulação fornece ISimulaçãoFísica e IConfiguraçãoAmbiente e requer IDadosObjetos e IPropriedadesMateriais. DetetorColisões fornece IDeteçãoColisões e ICálculoDanos e requer IEstadoSimulação e IPropriedadesObjetos. AnalisadorResultados fornece IAnáliseDesempenho e IEstatísticas e requer IDadosColisões e IResultadosSimulação.</p>
      <p><strong><a href="wiki.html#exportacao">Exportação</a></strong>: ExportadorDados fornece IExportaçãoCSV e IExportaçãoJSON e requer IResultadosAnálise do AnalisadorResultados.</p>
      <p><strong>Controlo</strong>: IControleSessão é distribuído a todos os portos (UI, Simulação, Colisões, Criação, Materiais, Análise, Exportação, Analytics) garantindo governança central.</p>
      <p><strong>Legibilidade</strong>: Layout vertical (A4) com espaçamento aumentado (nodesep, ranksep), nomes PT-PT e ligações diretas para minimizar cruzamentos; setas com direções explícitas onde necessário.</p>
    </section>
  </main>
  <script src="https://unpkg.com/plantuml-encoder/dist/plantuml-encoder.min.js"></script>
  <script>
    const src = document.getElementById('puml').textContent.trim();
    const encoded = window.plantumlEncoder.encode(src);
    const img = document.getElementById('diagram');
    const endpoints = [
      'https://kroki.io/plantuml/png/',
      'https://kroki.io/plantuml/svg/',
      'https://www.plantuml.com/plantuml/png/',
      'https://www.plantuml.com/plantuml/svg/',
      'https://plantuml.online/uml/'
    ];
    let i = 0;
    function tryNext() {
      if (i >= endpoints.length) {
        const f = document.getElementById('fallback');
        const u1 = endpoints[0] + encoded;
        const u2 = endpoints[2] + encoded;
        const u3 = endpoints[4] + encoded;
        f.innerHTML = 'Não foi possível carregar automaticamente. Abra manualmente: ' +
          '<a href="' + u3 + '" target="_blank" rel="noopener">PlantUML Online</a>, ' +
          '<a href="' + u1 + '" target="_blank" rel="noopener">Kroki PNG</a> ou ' +
          '<a href="' + u2 + '" target="_blank" rel="noopener">PlantUML PNG</a>';
        return;
      }
      img.src = endpoints[i] + encoded;
      img.onerror = function () { i++; tryNext(); };
    }
    tryNext();
  </script>
</body>
</html>
