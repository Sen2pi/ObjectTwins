<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Diagrama de Componentes — ObjectTwins</title>
  <style>
    body { font-family: Segoe UI, Roboto, Arial, sans-serif; margin: 0; padding: 0; }
    header { padding: 12px 16px; background: #0b5cff; color: #fff; }
    main { padding: 16px; }
    #diagram { width: 100%; border: 0; }
    pre { background: #f5f7fb; padding: 12px; overflow: auto; }
  </style>
</head>
<body>
  <header>Diagrama de Componentes — ObjectTwins Activity Provider</header>
  <main>
    <img id="diagram" src="" alt="Diagrama de Componentes ObjectTwins" style="width:100%; height:auto; border:0" referrerpolicy="no-referrer" loading="eager">
    <div id="fallback" style="margin-top:12px"></div>
    <h2>Código PlantUML</h2>
    <pre id="puml" style="white-space: pre-wrap">@startuml
skinparam componentStyle uml2
skinparam defaultTextAlignment center
skinparam shadowing false
skinparam nodesep 35
skinparam ranksep 70
top to bottom direction
scale 1024x1448

title ObjectTwins Activity Provider — Diagrama de Componentes

component "Inven!RA" as InvenRA #FFD54F
component "«subsystem» ObjectTwins" as ObjectTwinsSystem {
  port PortoInvenRA
}

interface IDadosAnalíticos
interface IConfiguraçãoAtividade
interface IVisualização
interface IDadosSimulação
interface IModelos3D
interface IControleSessão
interface IGestãoUtilizador
interface IAutenticaçãoInvenRA
interface IMétricasQuantitativas
interface IRelatóriosQualitativos
interface IDadosSessão
interface IDadosExportação
interface ICriaçãoObjetos
interface IModelagem3D
interface IDadosMateriais
interface IBaseDadosMateriais
interface IPropriedadesFísicas
interface ISimulaçãoFísica
interface IConfiguraçãoAmbiente
interface IDadosObjetos
interface IPropriedadesMateriais
interface IDeteçãoColisões
interface ICálculoDanos
interface IEstadoSimulação
interface IPropriedadesObjetos
interface IAnáliseDesempenho
interface IEstatísticas
interface IDadosColisões
interface IResultadosSimulação
interface IExportaçãoCSV
interface IExportaçãoJSON
interface IResultadosAnálise

component "«subsystem» Camada de Apresentação" as SubApresentacao #E8F1FF {
  component "«component» Visualizador3D" as Visualizador3D #90CAF9 {
    port PortoUI
  }
}

component "«subsystem» Camada de Gestão" as SubGestao #E8F5E9 {
  component "«component» GestorSessão" as GestorSessao #A5D6A7 {
    port PortoSessao
  }
  component "«component» GestorAnalytics" as GestorAnalytics #A5D6A7 {
    port PortoAnalytics
  }
}

component "«subsystem» Camada de Criação e Configuração" as SubCriacao #FFF3E0 {
  component "«component» CriadorObjetos" as CriadorObjetos #FFCC80 {
    port PortoCriacao
  }
  component "«component» GestorMateriais" as GestorMateriais #FFCC80 {
    port PortoMateriais
  }
}

component "«subsystem» Camada de Simulação e Análise" as SubSimulacao #F3E5F5 {
  component "«component» MotorSimulação" as MotorSimulacao #CE93D8 {
    port PortoSimulacao
  }
  component "«component» Detetor Colisões" as DetetorColisoes #CE93D8 {
    port PortoColisoes
  }
  component "«component» AnalisadorResultados" as AnalisadorResultados #CE93D8 {
    port PortoAnalise
  }
}

component "«subsystem» Camada de Exportação" as SubExportacao #E0F2F1 {
  component "«component» ExportadorDados" as ExportadorDados #80CBC4 {
    port PortoExportacao
  }
}

PortoInvenRA --> PortoSessao : [delegate] IConfiguraçãoAtividade
PortoAnalytics --> PortoInvenRA : [delegate] IDadosAnalíticos
InvenRA --> PortoInvenRA : IConfiguraçãoAtividade

Visualizador3D - IVisualização
Visualizador3D ..> IDadosSimulação
Visualizador3D ..> IModelos3D

GestorSessao - IControleSessão
GestorSessao - IGestãoUtilizador
GestorSessao ..> IAutenticaçãoInvenRA

GestorAnalytics - IMétricasQuantitativas
GestorAnalytics - IRelatóriosQualitativos
GestorAnalytics - IDadosAnalíticos
GestorAnalytics ..> IDadosSessão
GestorAnalytics ..> IDadosSimulação
GestorAnalytics ..> IDadosExportação

CriadorObjetos - ICriaçãoObjetos
CriadorObjetos - IModelagem3D
CriadorObjetos ..> IDadosMateriais

GestorMateriais - IBaseDadosMateriais
GestorMateriais - IPropriedadesFísicas

MotorSimulacao - ISimulaçãoFísica
MotorSimulacao - IConfiguraçãoAmbiente
MotorSimulacao ..> IDadosObjetos
MotorSimulacao ..> IPropriedadesMateriais

DetetorColisoes - IDeteçãoColisões
DetetorColisoes - ICálculoDanos
DetetorColisoes ..> IEstadoSimulação
DetetorColisoes ..> IPropriedadesObjetos

AnalisadorResultados - IAnáliseDesempenho
AnalisadorResultados - IEstatísticas
AnalisadorResultados ..> IDadosColisões
AnalisadorResultados ..> IResultadosSimulação

ExportadorDados - IExportaçãoCSV
ExportadorDados - IExportaçãoJSON
ExportadorDados ..> IResultadosAnálise

CriadorObjetos ..> GestorMateriais : IDadosMateriais
MotorSimulacao ..> CriadorObjetos : IDadosObjetos
MotorSimulacao ..> GestorMateriais : IPropriedadesMateriais
DetetorColisoes ..> MotorSimulacao : IEstadoSimulação
DetetorColisoes ..> CriadorObjetos : IPropriedadesObjetos
AnalisadorResultados ..> DetetorColisoes : IDadosColisões
AnalisadorResultados ..> MotorSimulacao : IResultadosSimulação
ExportadorDados ..> AnalisadorResultados : IResultadosAnálise
Visualizador3D ..> MotorSimulacao : IDadosSimulação
Visualizador3D ..> CriadorObjetos : IModelos3D
GestorAnalytics ..> GestorSessao : IDadosSessão
GestorAnalytics ..> MotorSimulacao : IDadosSimulação
GestorAnalytics ..> ExportadorDados : IDadosExportação

PortoSessao --> PortoUI : IControleSessão
PortoSessao --> PortoSimulacao : IControleSessão
PortoSessao --> PortoColisoes : IControleSessão
PortoSessao --> PortoCriacao : IControleSessão
PortoSessao --> PortoMateriais : IControleSessão
PortoSessao --> PortoAnalise : IControleSessão
PortoSessao --> PortoExportacao : IControleSessão
PortoSessao --> PortoAnalytics : IControleSessão

@enduml</pre>
    <h2>Explicação Geral</h2>
    <section>
      <p><strong><a href="wiki.html#sistema"></a>Sistema</a></strong>: «subsystem» ObjectTwins integra-se com Inven!RA via PortoInvenRA, recebendo IConfiguraçãoAtividade e publicando IDadosAnalíticos.</p>
      <p><strong><a href="wiki.html#apresentacao">Apresentação</a></strong>: Visualizador3D fornece IVisualização e requer IDadosSimulação e IModelos3D para renderização 3D.</p>
      <p><strong><a href="wiki.html#gestao">Gestão</a></strong>: GestorSessão fornece IControleSessão e IGestãoUtilizador e requer IAutenticaçãoInvenRA. GestorAnalytics fornece IMétricasQuantitativas e IRelatóriosQualitativos, requer IDadosSessão, IDadosSimulação e IDadosExportação e publica IDadosAnalíticos.</p>
      <p><strong><a href="wiki.html#criacao">Criação e Configuração</a></strong>: CriadorObjetos fornece ICriaçãoObjetos e IModelagem3D e requer IDadosMateriais do GestorMateriais, que fornece IBaseDadosMateriais e IPropriedadesFísicas.</p>
      <p><strong><a href="wiki.html#simulacao">Simulação e Análise</a></strong>: MotorSimulação fornece ISimulaçãoFísica e IConfiguraçãoAmbiente e requer IDadosObjetos e IPropriedadesMateriais. DetetorColisões fornece IDeteçãoColisões e ICálculoDanos e requer IEstadoSimulação e IPropriedadesObjetos. AnalisadorResultados fornece IAnáliseDesempenho e IEstatísticas e requer IDadosColisões e IResultadosSimulação.</p>
      <p><strong><a href="wiki.html#exportacao">Exportação</a></strong>: ExportadorDados fornece IExportaçãoCSV e IExportaçãoJSON e requer IResultadosAnálise do AnalisadorResultados.</p>
      <p><strong>Controlo</strong>: IControleSessão é distribuído a todos os portos (UI, Simulação, Colisões, Criação, Materiais, Análise, Exportação, Analytics) garantindo governança central.</p>
      <p><strong>Legibilidade</strong>: Layout vertical (A4) com espaçamento aumentado (nodesep, ranksep), nomes PT-PT e ligações diretas para minimizar cruzamentos; setas com direções explícitas onde necessário.</p>
    </section>
  </main>
  <script src="https://unpkg.com/plantuml-encoder/dist/plantuml-encoder.min.js"></script>
  <script>
    const src = document.getElementById('puml').textContent.trim();
    const encoded = window.plantumlEncoder.encode(src);
    const img = document.getElementById('diagram');
    const endpoints = [
      'https://kroki.io/plantuml/png/',
      'https://kroki.io/plantuml/svg/',
      'https://www.plantuml.com/plantuml/png/',
      'https://www.plantuml.com/plantuml/svg/',
      'https://plantuml.online/uml/'
    ];
    let i = 0;
    function tryNext() {
      if (i >= endpoints.length) {
        const f = document.getElementById('fallback');
        const u1 = endpoints[0] + encoded;
        const u2 = endpoints[2] + encoded;
        const u3 = endpoints[4] + encoded;
        f.innerHTML = 'Não foi possível carregar automaticamente. Abra manualmente: ' +
          '<a href="' + u3 + '" target="_blank" rel="noopener">PlantUML Online</a>, ' +
          '<a href="' + u1 + '" target="_blank" rel="noopener">Kroki PNG</a> ou ' +
          '<a href="' + u2 + '" target="_blank" rel="noopener">PlantUML PNG</a>';
        return;
      }
      img.src = endpoints[i] + encoded;
      img.onerror = function () { i++; tryNext(); };
    }
    tryNext();
  </script>
</body>
</html>
